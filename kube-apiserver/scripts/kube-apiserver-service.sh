#!/bin/bash
../bin/kube-apiserver \
      --v=2  \
      --logtostderr=true  \
      --allow-privileged=true  \
      --bind-address=0.0.0.0  \
      --secure-port=6443  \
      --insecure-port=0  \
      --advertise-address=172.16.100.61 \
      --service-cluster-ip-range=10.99.0.0/16  \
      --service-node-port-range=30000-32767  \
      --etcd-servers=https://172.16.100.61:2379,https://172.16.100.62:2379,https://172.16.100.63:2379 \
      --etcd-cafile=/data/applications/etcd-service/certs/etcd-service-ca.pem  \
      --etcd-certfile=/data/applications/etcd-service/certs/etcd-server-keys.pem \
      --etcd-keyfile=/data/applications/etcd-service/certs/etcd-server-keys-key.pem \
      --client-ca-file=../certs/kubernetes-ca.pem \
      --tls-cert-file=../certs/kube-apiserver.pem  \
      --tls-private-key-file=../certs/kube-apiserver-key.pem  \
      --kubelet-client-certificate=../certs/kube-apiserver.pem  \
      --kubelet-client-key=../certs/kube-apiserver-key.pem  \
      --service-account-private-key-file=../certs/service-account.key  \
      --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname  \
      --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,NodeRestriction,ResourceQuota  \
      --authorization-mode=Node,RBAC  \
      --enable-bootstrap-token-auth=true  \
      --log-dir=/opt/logs/kubernetes/kube-apiserver \
      --audit-log-mode=batch \
      --audit-policy-file=../conf/audit-policy.yaml \
      --audit-log-path=/opt/logs/kubernetes/kube-apiserver-service/kubernetes_audit_info.log \
      --audit-log-maxbackup=10 \
      --audit-log-maxage=30 \
      --audit-log-maxsize=100 \
      --requestheader-client-ca-file=../certs/front-proxy-ca.pem \
      --proxy-client-cert-file=../certs/front-proxy-client.pem \
      --proxy-client-key-file=../certs/front-proxy-client-key.pem \
      --requestheader-allowed-names=aggregator  \
      --requestheader-group-headers=X-Remote-Group  \
      --requestheader-extra-headers-prefix=X-Remote-Extra-  \
      --requestheader-username-headers=X-Remote-User